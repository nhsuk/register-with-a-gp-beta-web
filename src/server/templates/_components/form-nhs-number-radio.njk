{##
 # Family: Control
 #
 # @param {string}       [variant]  Type of choice (radio|checkbox)
 # @param {string}       [label]    Label for the form elements
 # @param {string}       [name]     Name for the form group
 # @param {array}        [children] List of options to display
 #
 # @param {string}       [hint]     Hint text for the field (optional)
 # @param {bool}         [inline]   Whether to display the choices inline (optional)
 # @param {string|array} [value]    The current value. Used to determine whether to precheck a field (optional)
 # @param {string}       [error]    Whether to display an error on the field (optional)
 # @param {bool}         [optional] Whether the field is optional or not (optional)
 #
 # @return {string} HTML for multiple choice options
 #
 # @example
 #   {% component 'form-multiple-choice', {
 #     type:  'radio',
 #     label: 'Which option is your favourite?',
 #     name:  'favourites',
 #     children: [{
 #       label: 'Option 1',
 #       value: '1'
 #     }, {
 #       label: 'Option 2',
 #       value: '2'
 #     }]
 #   } %}
 #}
{% set hintId = 'hint-' + name %}

<fieldset id="input-{{ name }}">
  {% if label or hint or error %}
    <legend class="form-label" id="group-{{ name }}">
      {{ label }} {% if optional %}(optional){% endif %}
      {% if hint %}
        <span class="form-label__hint" id="{{ hintId }}">{{ hint }}</span>
      {% endif %}
    </legend>
  {% endif %}

  <div class="multiple-choice__container margin-btm20">
    {% for option in children %}
      {% set inputValue = option.value if 'value' in option else option.label %}
      {% set inputId = ['input', name, loop.index] | join('--') %}

      {% if variant == 'checkbox' %}
        {% set isSelected = (value and (inputValue in value)) %}
      {% else %}
        {% set isSelected = (inputValue | string == value | default('') | string) %}
      {% endif %}

      <label
        for="{{ inputId }}"
        class="multiple-choice multiple-choice--{{ variant | default('radio') }}{{ ' multiple-choice--inline' if inline }}{{ ' has-error' if error }} multiple-choice-radio-horizontal nhs-number-radio"
        data-label="{{ option.label }}" data-show-nested-field="{{ option.show_nhs_number_input }}"
      >
        {{ option.label }}
        <input
          type="{{ variant | default('radio') }}"
          name="{{ name }}"
          id="{{ inputId }}"
          value="{{ inputValue }}"
          class="multiple-choice__input"
          {% if isSelected %}
            checked="checked"
          {% endif %}
          {% if hint %}
            aria-describedby="{{ hintId }}"
          {% endif %}
        >
      </label>
    {% endfor %}
  </div>
  {% if nestedField %}
        {% set nestedFieldError = stepErrors[nestedField].message | replace(stepErrors[nestedField].label, "") %}

        {% set showNestedField = (value == nestedFieldVisibleValue) %}

        <div id="nhs-number-nested-container" style="{{ 'display:none' if not showNestedField }}" class="nestedFieldContainer">
            <label for="input-nhs-number" class="form-label">
                NHS number
                <input type="text" name="nhs-number" id="input-nhs-number" class="form-textbox form-textbox--short {{ ' has-error' if nestedFieldError }}" value="{{ stepData[nestedField] | default('') }} ">
            </label>
        </div>
    {% endif %}
</fieldset>
